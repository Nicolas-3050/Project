{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\seill\\\\OneDrive\\\\Documents\\\\web_services\\\\sumatohomu\\\\src\\\\components\\\\utils\\\\AuthProvider.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport requester from \"../../modules/requester\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\n\nconst AuthProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  // Signin etc...\n  const [token, setToken] = useState(localStorage.getItem(\"sumatohomu_token\"));\n\n  if (token) {\n    requester.defaults.headers.common = { ...requester.defaults.headers.common,\n      Authorization: `Bearer ${token}`\n    };\n  }\n\n  const signin = async (email, password, callback) => {\n    try {\n      const response = await requester.post(\"user/login\", {\n        email,\n        password\n      });\n      setToken(response.data.data.token);\n\n      if (response.data.data.token) {\n        requester.defaults.headers.common = { ...requester.defaults.headers.common,\n          Authorization: `Bearer ${response.data.data.token}`\n        };\n        localStorage.setItem(\"sumatohomu_token\", response.data.data.token);\n      }\n\n      if (callback) {\n        callback();\n      }\n    } catch (error) {\n      if (callback) {\n        callback(error);\n        return;\n      }\n\n      throw new Error(error);\n    }\n  };\n\n  const signup = async (email, username, password, callback) => {\n    try {\n      await requester.post(\"user\", {\n        email,\n        password,\n        username\n      });\n\n      if (callback) {\n        callback();\n      }\n    } catch (error) {\n      if (callback) {\n        callback(error);\n        return;\n      }\n\n      throw new Error(error);\n    }\n  };\n\n  const signout = callback => {\n    localStorage.removeItem(\"sumatohomu_token\");\n    setToken(null);\n\n    if (callback) {\n      callback();\n    }\n  }; // Try to get the token at mount\n\n\n  useEffect(() => {\n    if (!token) {\n      const value = localStorage.getItem(\"sumatohomu_token\");\n\n      if (value) {\n        requester.defaults.headers.common = { ...requester.defaults.headers.common,\n          Authorization: `Bearer ${value}`\n        };\n        setToken(value);\n      } else {\n        requester.defaults.headers.common = { ...requester.defaults.headers.common,\n          Authorization: false\n        };\n      }\n    }\n  }, [token]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      token,\n      signin,\n      signup,\n      signout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AuthProvider, \"6U/lZIlo0w6xqlQPgfwVOGP1Xyw=\");\n\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport default AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/seill/OneDrive/Documents/web_services/sumatohomu/src/components/utils/AuthProvider.tsx"],"names":["createContext","useContext","useEffect","useState","requester","AuthContext","AuthProvider","children","token","setToken","localStorage","getItem","defaults","headers","common","Authorization","signin","email","password","callback","response","post","data","setItem","error","Error","signup","username","signout","removeItem","value","useAuth"],"mappings":"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","sourcesContent":["import {\r\n  createContext,\r\n  FunctionComponent,\r\n  useContext,\r\n  useEffect,\r\n  useState,\r\n} from \"react\";\r\nimport requester from \"../../modules/requester\";\r\n\r\ninterface AuthContextType {\r\n  token: string | null;\r\n  signin: (\r\n    email: string,\r\n    password: string,\r\n    callback?: (err?: any) => void\r\n  ) => Promise<void>;\r\n  signup: (\r\n    email: string,\r\n    username: string,\r\n    password: string,\r\n    callback?: (err?: any) => void\r\n  ) => Promise<void>;\r\n  signout: (callback?: VoidFunction) => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>(null!);\r\n\r\nconst AuthProvider: FunctionComponent = ({ children }) => {\r\n  // Signin etc...\r\n  const [token, setToken] = useState<string | null>(\r\n    localStorage.getItem(\"sumatohomu_token\")\r\n  );\r\n  if (token) {\r\n    requester.defaults.headers.common = {\r\n      ...requester.defaults.headers.common,\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  }\r\n  const signin = async (\r\n    email: string,\r\n    password: string,\r\n    callback?: (err?: any) => void\r\n  ) => {\r\n    try {\r\n      const response = await requester.post(\"user/login\", { email, password });\r\n      setToken(response.data.data.token);\r\n      if (response.data.data.token) {\r\n        requester.defaults.headers.common = {\r\n          ...requester.defaults.headers.common,\r\n          Authorization: `Bearer ${response.data.data.token}`,\r\n        };\r\n        localStorage.setItem(\"sumatohomu_token\", response.data.data.token);\r\n      }\r\n      if (callback) {\r\n        callback();\r\n      }\r\n    } catch (error) {\r\n      if (callback) {\r\n        callback(error);\r\n        return;\r\n      }\r\n      throw new Error(error as string);\r\n    }\r\n  };\r\n  const signup = async (\r\n    email: string,\r\n    username: string,\r\n    password: string,\r\n    callback?: (err?: any) => void\r\n  ) => {\r\n    try {\r\n      await requester.post(\"user\", { email, password, username });\r\n      if (callback) {\r\n        callback();\r\n      }\r\n    } catch (error) {\r\n      if (callback) {\r\n        callback(error);\r\n        return;\r\n      }\r\n      throw new Error(error as string);\r\n    }\r\n  };\r\n  const signout = (callback?: VoidFunction) => {\r\n    localStorage.removeItem(\"sumatohomu_token\");\r\n    setToken(null);\r\n    if (callback) {\r\n      callback();\r\n    }\r\n  };\r\n\r\n  // Try to get the token at mount\r\n  useEffect(() => {\r\n    if (!token) {\r\n      const value = localStorage.getItem(\"sumatohomu_token\");\r\n      if (value) {\r\n        requester.defaults.headers.common = {\r\n          ...requester.defaults.headers.common,\r\n          Authorization: `Bearer ${value}`,\r\n        };\r\n        setToken(value);\r\n      } else {\r\n        requester.defaults.headers.common = {\r\n          ...requester.defaults.headers.common,\r\n          Authorization: false,\r\n        };\r\n      }\r\n    }\r\n  }, [token]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ token, signin, signup, signout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => {\r\n  return useContext(AuthContext);\r\n};\r\n\r\nexport default AuthProvider;\r\n"]},"metadata":{},"sourceType":"module"}